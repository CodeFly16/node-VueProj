(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d2214b0"],{ca73:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("a-card",[a("a-button",{attrs:{type:"primary"},on:{click:e.showModal}},[e._v(" 借书 ")]),a("a-input-search",{staticStyle:{width:"300px","margin-left":"30px"},attrs:{placeholder:"输入借书证号查询所有信息"},on:{search:e.searchRd}}),a("a-spin",{attrs:{tip:"Loading...",spinning:e.spinning}},[a("a-table",{staticStyle:{"margin-top":"10px"},attrs:{bordered:"","data-source":e.dataSource,columns:e.columns},scopedSlots:e._u([{key:"operation",fn:function(t,n){return[e.dataSource.length?a("a-popconfirm",{attrs:{title:"确认删除吗"},on:{confirm:function(){return e.onDelete(n._id)}}},[a("a-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger"}},[e._v(" 删除 ")])],1):e._e(),a("a-button",{staticStyle:{"margin-left":"10px"},on:{click:function(t){return e.edit(n._id)}}},[e._v("详情")]),e.dataSource.length?a("a-popconfirm",{attrs:{title:"确认续借吗"},on:{confirm:function(){return e.reLendBook(n)}}},[a("a-button",{staticStyle:{"margin-left":"10px"}},[e._v("续借")])],1):e._e(),e.dataSource.length?a("a-popconfirm",{attrs:{title:"确认还书吗"},on:{confirm:function(){return e.returnBook(n)}}},[a("a-button",{staticStyle:{"margin-left":"10px"}},[e._v("还书")])],1):e._e()]}}])})],1),a("a-modal",{attrs:{title:"借书"},on:{ok:e.handleOk},model:{value:e.visible,callback:function(t){e.visible=t},expression:"visible"}},[a("template",{slot:"footer"},[a("a-button",{key:"back",on:{click:function(t){e.visible=!1}}},[e._v(" 取消 ")]),a("a-button",{key:"submit",attrs:{type:"primary",disabled:!e.isCanLend},on:{click:e.handleOk}},[e._v(" 确认 ")])],1),a("a-form",{attrs:{"label-col":e.labelCol,"wrapper-col":e.wrapperCol}},[e.isEdit?e._e():[a("a-form-item",{attrs:{label:"借书证搜索"}},[a("a-input-search",{attrs:{placeholder:"输入借书证号"},on:{search:e.searchRd}})],1),e.rdInfo.show?a("a-form-item",{attrs:{label:"读者相关信息"}},[a("div",[e._v(" 读者状态:"+e._s(e.rdInfo.status)+" ")]),a("div",[e._v(" 已借书籍数量:"+e._s(e.rdInfo.lendCount)+" ")]),a("div",[e._v(" 可借书籍数量:"+e._s(e.rdInfo.canLendCount)+" ")])]):e._e(),a("a-form-item",{attrs:{label:"待借图书搜索"}},[a("a-input-search",{attrs:{placeholder:"输入待借图书书号"},on:{search:e.searchBook}})],1),e.bkInfo.show?a("a-form-item",{attrs:{label:"图书相关信息"}},[a("div",[e._v(" 书籍状态:"+e._s(e.bkInfo.status)+" ")])]):e._e()],e.isCanLend||e.isEdit?[a("a-form-item",{attrs:{label:"读者序号"}},[a("a-input",{attrs:{placeholder:"请输入读者序号",disabled:""},model:{value:e.model.rdID,callback:function(t){e.$set(e.model,"rdID",t)},expression:"model.rdID"}})],1),a("a-form-item",{attrs:{label:"图书序号"}},[a("a-input",{attrs:{placeholder:"请输入图书序号",disabled:""},model:{value:e.model.bkID,callback:function(t){e.$set(e.model,"bkID",t)},expression:"model.bkID"}})],1),a("a-form-item",{attrs:{label:"续借次数"}},[a("a-input",{attrs:{placeholder:"请输入续借次数"},model:{value:e.model.ldContinueTimes,callback:function(t){e.$set(e.model,"ldContinueTimes",t)},expression:"model.ldContinueTimes"}})],1),a("a-form-item",{attrs:{label:"借书日期"}},[a("a-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择借书日期"},on:{change:e.setDate},model:{value:e.model.ldDateOut,callback:function(t){e.$set(e.model,"ldDateOut",t)},expression:"model.ldDateOut"}})],1),a("a-form-item",{attrs:{label:"应还日期"}},[a("a-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择应还日期",disabled:""},model:{value:e.model.ldDateRetPlan,callback:function(t){e.$set(e.model,"ldDateRetPlan",t)},expression:"model.ldDateRetPlan"}})],1),a("a-form-item",{attrs:{label:"实际还书日期"}},[a("a-date-picker",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择实际还书日期",disabled:""},model:{value:e.model.ldDateRetAct,callback:function(t){e.$set(e.model,"ldDateRetAct",t)},expression:"model.ldDateRetAct"}})],1),a("a-form-item",{attrs:{label:"超期天数"}},[a("a-input",{attrs:{placeholder:"请输入超期天数",disabled:""},model:{value:e.model.ldOverDay,callback:function(t){e.$set(e.model,"ldOverDay",t)},expression:"model.ldOverDay"}})],1),a("a-form-item",{attrs:{label:"超期金额"}},[a("a-input",{attrs:{placeholder:"请输入超期金额（应罚款金额）",disabled:""},model:{value:e.model.ldOverMoney,callback:function(t){e.$set(e.model,"ldOverMoney",t)},expression:"model.ldOverMoney"}})],1),a("a-form-item",{attrs:{label:"罚款金额"}},[a("a-input",{attrs:{placeholder:"请输入罚款金额",disabled:""},model:{value:e.model.ldPunishMoney,callback:function(t){e.$set(e.model,"ldPunishMoney",t)},expression:"model.ldPunishMoney"}})],1),a("a-form-item",{attrs:{label:"是否已经还书"}},[a("a-switch",{attrs:{"default-checked":""},model:{value:e.model.lsHasReturn,callback:function(t){e.$set(e.model,"lsHasReturn",t)},expression:"model.lsHasReturn"}})],1),a("a-form-item",{attrs:{label:"借书操作员"}},[a("a-input",{attrs:{placeholder:"请输入借书操作员"},model:{value:e.model.OperatorLend,callback:function(t){e.$set(e.model,"OperatorLend",t)},expression:"model.OperatorLend"}})],1),a("a-form-item",{attrs:{label:"还书操作员"}},[a("a-input",{attrs:{placeholder:"请输入还书操作员"},model:{value:e.model.OperatorRet,callback:function(t){e.$set(e.model,"OperatorRet",t)},expression:"model.OperatorRet"}})],1)]:e._e()],2)],2)],1)},r=[],o=(a("4160"),a("159b"),a("2909")),s=(a("96cf"),a("1da1")),l={name:"borrowManagement",data:function(){return{model:{rdID:"",bkID:"",ldContinueTimes:0,ldDateOut:"",ldDateRetPlan:"",ldDateRetAct:"",ldOverDay:0,ldOverMoney:0,ldPunishMoney:0,lsHasReturn:!1},labelCol:{span:7},wrapperCol:{span:14},dataSource:[],columns:[{title:"读者序号",dataIndex:"rdID"},{title:"图书序号",dataIndex:"bkID"},{title:"续借次数",dataIndex:"ldContinueTimes"},{title:"借书日期",dataIndex:"ldDateOut"},{title:"是否已经还书",dataIndex:"lsHasReturn"},{title:"操作",dataIndex:"operation",scopedSlots:{customRender:"operation"},width:"400px"}],rdInfo:{show:!1,status:"",lendCount:0,canLendCount:0,canLendDay:0},bkInfo:{show:!1,status:""},spinning:!0,visible:!1,isEdit:!1}},computed:{isCanLend:function(){return console.log("正常"===this.rdInfo.status&&this.rdInfo.lendCount<this.rdInfo.canLendCount&&"在馆"===this.bkInfo.status),"正常"===this.rdInfo.status&&this.rdInfo.lendCount<this.rdInfo.canLendCount&&"在馆"===this.bkInfo.status}},created:function(){console.log(this.$moment("add","7 days")),this.loadData()},methods:{setDate:function(e,t){console.log(e),this.model.ldDateOut=t,this.model.ldDateRetPlan=this.$moment(t).add(this.rdInfo.canLendDay,"days").format("YYYY-MM-DD "),console.log(this.model.ldDateRetPlan)},searchRd:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$http[0].get("/search/readerInfo/".concat(e));case 2:if(n=a.sent,200!==n.status){a.next=13;break}return t.rdInfo.status=n.data.rdStatus,t.rdInfo.lendCount=n.data.rdLendCount,a.next=8,t.$http[0].get("search/readerType/".concat(n.data.rdType));case 8:r=a.sent,t.rdInfo.canLendCount=r.data.canLendQty,t.rdInfo.canLendDay=r.data.canLendDay,t.model.rdID=e,t.rdInfo.show=!0;case 13:case"end":return a.stop()}}),a)})))()},searchBook:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$http[0].get("/search/book/".concat(e));case 2:n=a.sent,200===n.status&&(t.bkInfo.status=n.data.bkStatus,t.model.bkID=e,t.bkInfo.show=!0);case 4:case"end":return a.stop()}}),a)})))()},returnBook:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:if(console.log(e),"未还"!==e.lsHasReturn){a.next=10;break}return e.lsHasReturn=!0,e.ldDateRetAct=t.$moment().format("YYYY-MM-DD"),a.next=6,t.$http[0].post("/returnBook",e);case 6:n=a.sent,200===n.status&&(t.loadData(),t.$message.success("还书成功")),a.next=11;break;case 10:t.$message.warning("此书已还");case 11:case"end":return a.stop()}}),a)})))()},reLendBook:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n,r,o,s,l;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return console.log(e),a.next=3,t.$http[0].get("/search/readerInfo/".concat(e.rdID));case 3:if(n=a.sent,200!==n.status){a.next=28;break}return a.next=7,t.$http[0].get("search/readerType/".concat(n.data.rdType));case 7:if(r=a.sent,o=r.data.canLendDay,s=r.data.relendNum,"未还"!==e.lsHasReturn){a.next=25;break}if(e.ldContinueTimes!==s){a.next=15;break}t.$message.warning("已超过最大续借次数"),a.next=23;break;case 15:return e.ldContinueTimes++,e.ldDateRetPlan=t.$moment(e.ldDateRetPlan).add(o,"days").format("YYYY-MM-DD "),e.lsHasReturn=!1,console.log(e),a.next=21,t.$http[0].post("/reLendBook",e);case 21:l=a.sent,200===l.status&&(t.loadData(),t.$message.success("续借成功"));case 23:a.next=26;break;case 25:t.$message.warning("此书已还");case 26:console.log(o),console.log(s);case 28:case"end":return a.stop()}}),a)})))()},onDelete:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return a.next=2,t.$http[0].delete("/rest/borrowInfo/".concat(e));case 2:n=a.sent,200===n.status&&(t.loadData(),t.$message.success("删除成功"));case 4:case"end":return a.stop()}}),a)})))()},loadData:function(){var e=this;return Object(s["a"])(regeneratorRuntime.mark((function t(){var a;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.dataSource=[],t.next=3,e.$http[0].get("/rest/borrowInfo");case 3:a=t.sent,e.dataSource=Object(o["a"])(a.data),e.dataSource.forEach((function(t){console.log(t.lsHasReturn),t.lsHasReturn?t.lsHasReturn="已还":t.lsHasReturn="未还",t.ldDateOut=e.$moment(t.ldDateOut).format("YYYY-MM-DD")})),e.spinning=!1,console.log(e.dataSource);case 8:case"end":return t.stop()}}),t)})))()},showModal:function(){this.isEdit=!1,this.model={rdID:"",bkID:"",ldContinueTimes:0,ldDateOut:"",ldDateRetPlan:"",ldDateRetAct:"",ldOverDay:0,ldOverMoney:0,ldPunishMoney:0,lsHasReturn:!1},this.visible=!0},handleOk:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function e(){var a;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$http[0].post("/borrowBook",t.model);case 2:a=e.sent,200===a.status&&(t.loadData(),t.$message.success("借书成功")),t.visible=!1;case 5:case"end":return e.stop()}}),e)})))()},edit:function(e){var t=this;return Object(s["a"])(regeneratorRuntime.mark((function a(){var n,r;return regeneratorRuntime.wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.isEdit=!0,a.next=3,t.$http[0].get("/rest/borrowInfo/".concat(e));case 3:n=a.sent,r=n.data,t.model=r,t.visible=!0;case 7:case"end":return a.stop()}}),a)})))()}}},d=l,i=a("2877"),c=Object(i["a"])(d,n,r,!1,null,"5747d75d",null);t["default"]=c.exports}}]);
//# sourceMappingURL=chunk-2d2214b0.6eefa7d3.js.map